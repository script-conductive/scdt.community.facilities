<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<meta http-equiv="X-UA-Compatible" content="chrome=1, IE=edge">
<title>Richard's Journey</title>
<link href="tabulator-4.8.2.css" rel="stylesheet">
<script src="tabulator-4.8.2.js"></script>
<style type="text/css">
* {
  font-family: "Arial";
}
body {
  margin:0;
  padding: 20px;
}
.table {
  margin-bottom: 20px;
}
.header img {
  float: left;
  width: 35px;
  margin-right: 10px;
}
.header h1  {
  position: relative;
  top: 5px;
  font-size: 20px;
}
</style>
<script>
const persona = {
  name: "Richard"
}

const expectedActorsMap = {
  "_8iYY4BhSEeuxgcy6_kiY6g": {
     oid: "_8iYY4BhSEeuxgcy6_kiY6g",
     name: "Friendly Staff",
     generalization: [
     ]
   },  
  "_6YpFMBhSEeuxgcy6_kiY6g": {
     oid: "_6YpFMBhSEeuxgcy6_kiY6g",
     name: "Good Seat",
     generalization: [
     ]
   },  
  "_7fWOkBhSEeuxgcy6_kiY6g": {
     oid: "_7fWOkBhSEeuxgcy6_kiY6g",
     name: "Great Movie",
     generalization: [
     ]
   }  
};

const stageUseCases = [
  {oid: "_U8SCIBg2EeuH77eS3yKljg", name: "Decide"},
    {oid: "_acuL4Bg2EeuH77eS3yKljg", name: "Travel"},
    {oid: "_fHWvABg2EeuH77eS3yKljg", name: "Experience"},
    {oid: "_nj3oUBg2EeuH77eS3yKljg", name: "Return"},
];

const stageUseCasesOidMap = stageUseCases.map((s) => {
 return s.oid
});


const stagesMapTemp = {
  "_U8SCIBg2EeuH77eS3yKljg": {
    oid: "_U8SCIBg2EeuH77eS3yKljg",
    name: "Decide",
    steps: [
        {oid: "_FtT9kBg2EeuH77eS3yKljg", name: "Looks up movies"},
        {oid: "_I1cMIBg2EeuH77eS3yKljg", name: "Decides which movies to see and which theater to go to"},
        {oid: "_KUoG8Bg2EeuH77eS3yKljg", name: "Buys ticket online"}, 
    ]
  },  
  "_acuL4Bg2EeuH77eS3yKljg": {
    oid: "_acuL4Bg2EeuH77eS3yKljg",
    name: "Travel",
    steps: [
        {oid: "_PGR4EBg2EeuH77eS3yKljg", name: "Drives to movie theater"},
        {oid: "_QGjCQBg2EeuH77eS3yKljg", name: "Stands in line and buys popcorn"},
        {oid: "_ROp50Bg2EeuH77eS3yKljg", name: "Finds seat"}, 
    ]
  },  
  "_fHWvABg2EeuH77eS3yKljg": {
    oid: "_fHWvABg2EeuH77eS3yKljg",
    name: "Experience",
    steps: [
        {oid: "_d9828Bg2EeuH77eS3yKljg", name: "Watches movie"}, 
    ]
  },  
  "_nj3oUBg2EeuH77eS3yKljg": {
    oid: "_nj3oUBg2EeuH77eS3yKljg",
    name: "Return",
    steps: [
        {oid: "_kB8ZsBg2EeuH77eS3yKljg", name: "Exits theater"},
        {oid: "_lK4-wBg2EeuH77eS3yKljg", name: "Drives home"}, 
    ]
  }  
};

let stagesMap = {};
for (const [stageOid, stageObj] of Object.entries(stagesMapTemp)) {
  if (stageUseCasesOidMap.includes(stageOid)) {
    stagesMap[stageOid] = stageObj;
  }
}
console.log("stagesMap", stagesMap);

let relevantStagesNameMap = [];
for (const [stageOid, stageObj] of Object.entries(stagesMapTemp)) {
  if (stageUseCasesOidMap.includes(stageOid)) {
    relevantStagesNameMap.push(stageObj.name)
  }
}
console.log("relevantStagesNameMap", relevantStagesNameMap);

let irrelevantStagesNameMap = [];
for (const [stageOid, stageObj] of Object.entries(stagesMapTemp)) {
  if (!stageUseCasesOidMap.includes(stageOid)) {
    irrelevantStagesNameMap.push(stageObj.name)
  }
}

console.log("irrelevantStagesNameMap", irrelevantStagesNameMap);

const stepsMap = {
  "_FtT9kBg2EeuH77eS3yKljg": {
    oid: "_FtT9kBg2EeuH77eS3yKljg",
    name: "Looks up movies",
    usedTimeValue: "10.0",
    usedTimeUnit: "Minute",
    serviceResources: [
      {oid: "_97Iv0Bg3EeuH77eS3yKljg", name: "Mobile App Developer"}      
    ]
  },  
  "_I1cMIBg2EeuH77eS3yKljg": {
    oid: "_I1cMIBg2EeuH77eS3yKljg",
    name: "Decides which movies to see and which theater to go to",
    usedTimeValue: "15.0",
    usedTimeUnit: "Minute",
    serviceResources: [
      {oid: "_97Iv0Bg3EeuH77eS3yKljg", name: "Mobile App Developer"}      
    ]
  },  
  "_KUoG8Bg2EeuH77eS3yKljg": {
    oid: "_KUoG8Bg2EeuH77eS3yKljg",
    name: "Buys ticket online",
    usedTimeValue: "1.0",
    usedTimeUnit: "Minute",
    serviceResources: [
      {oid: "_97Iv0Bg3EeuH77eS3yKljg", name: "Mobile App Developer"}      
    ]
  },  
  "_PGR4EBg2EeuH77eS3yKljg": {
    oid: "_PGR4EBg2EeuH77eS3yKljg",
    name: "Drives to movie theater",
    usedTimeValue: "0.0",
    usedTimeUnit: "Second",
    serviceResources: [
      {oid: "_sH7-gBg4EeuH77eS3yKljg", name: "Theater Staff"}      
    ]
  },  
  "_QGjCQBg2EeuH77eS3yKljg": {
    oid: "_QGjCQBg2EeuH77eS3yKljg",
    name: "Stands in line and buys popcorn",
    usedTimeValue: "0.0",
    usedTimeUnit: "Second",
    serviceResources: [
      {oid: "_mgIogBg4EeuH77eS3yKljg", name: "Theater Facility"}      
    ]
  },  
  "_ROp50Bg2EeuH77eS3yKljg": {
    oid: "_ROp50Bg2EeuH77eS3yKljg",
    name: "Finds seat",
    usedTimeValue: "0.0",
    usedTimeUnit: "Second",
    serviceResources: [
      {oid: "_mgIogBg4EeuH77eS3yKljg", name: "Theater Facility"},      
      {oid: "_XmRdABhTEeuxgcy6_kiY6g", name: "Seat"}      
    ]
  },  
  "_d9828Bg2EeuH77eS3yKljg": {
    oid: "_d9828Bg2EeuH77eS3yKljg",
    name: "Watches movie",
    usedTimeValue: "0.0",
    usedTimeUnit: "Second",
    serviceResources: [
      {oid: "_LAjSoBhTEeuxgcy6_kiY6g", name: "Movie"}      
    ]
  },  
  "_kB8ZsBg2EeuH77eS3yKljg": {
    oid: "_kB8ZsBg2EeuH77eS3yKljg",
    name: "Exits theater",
    usedTimeValue: "0.0",
    usedTimeUnit: "Second",
    serviceResources: [
      {oid: "_mgIogBg4EeuH77eS3yKljg", name: "Theater Facility"}      
    ]
  },  
  "_lK4-wBg2EeuH77eS3yKljg": {
    oid: "_lK4-wBg2EeuH77eS3yKljg",
    name: "Drives home",
    usedTimeValue: "0.0",
    usedTimeUnit: "Second",
    serviceResources: [
      {oid: "_sH7-gBg4EeuH77eS3yKljg", name: "Theater Staff"}      
    ]
  }  
};

const serviceResourcesMap = {
  "_97Iv0Bg3EeuH77eS3yKljg": {
    oid: "_97Iv0Bg3EeuH77eS3yKljg",
    resourceType: "«Personnel»",
  },  
  "_mgIogBg4EeuH77eS3yKljg": {
    oid: "_mgIogBg4EeuH77eS3yKljg",
    resourceType: "«Site»",
  },  
  "_sH7-gBg4EeuH77eS3yKljg": {
    oid: "_sH7-gBg4EeuH77eS3yKljg",
    resourceType: "«Personnel»",
  },  
  "_LAjSoBhTEeuxgcy6_kiY6g": {
    oid: "_LAjSoBhTEeuxgcy6_kiY6g",
    resourceType: "«Data»",
  },  
  "_XmRdABhTEeuxgcy6_kiY6g": {
    oid: "_XmRdABhTEeuxgcy6_kiY6g",
    resourceType: "«Hardware»",
  }  
};

const stepTouchpointMap = {
  "_FtT9kBg2EeuH77eS3yKljg": {oid: "_zt2HUBg1EeuH77eS3yKljg", name: "Mobile App"},  "_I1cMIBg2EeuH77eS3yKljg": {oid: "_zt2HUBg1EeuH77eS3yKljg", name: "Mobile App"},  "_KUoG8Bg2EeuH77eS3yKljg": {oid: "_zt2HUBg1EeuH77eS3yKljg", name: "Mobile App"},  "_PGR4EBg2EeuH77eS3yKljg": {oid: "_0ng6QBg1EeuH77eS3yKljg", name: "Movie Theater"},  "_QGjCQBg2EeuH77eS3yKljg": {oid: "_0ng6QBg1EeuH77eS3yKljg", name: "Movie Theater"},  "_ROp50Bg2EeuH77eS3yKljg": {oid: "_0ng6QBg1EeuH77eS3yKljg", name: "Movie Theater"},  "_d9828Bg2EeuH77eS3yKljg": {oid: "_0ng6QBg1EeuH77eS3yKljg", name: "Movie Theater"},  "_kB8ZsBg2EeuH77eS3yKljg": {oid: "_0ng6QBg1EeuH77eS3yKljg", name: "Movie Theater"},  "_lK4-wBg2EeuH77eS3yKljg": {oid: "_0ng6QBg1EeuH77eS3yKljg", name: "Movie Theater"}};

const touchpoints = [
  {oid: "_0ng6QBg1EeuH77eS3yKljg", name: "Movie Theater", resourceType: "«Site»",
   usecases: [
     {oid: "_PGR4EBg2EeuH77eS3yKljg", name: "Drives to movie theater"},    
     {oid: "_QGjCQBg2EeuH77eS3yKljg", name: "Stands in line and buys popcorn"},    
     {oid: "_ROp50Bg2EeuH77eS3yKljg", name: "Finds seat"},    
     {oid: "_d9828Bg2EeuH77eS3yKljg", name: "Watches movie"},    
     {oid: "_kB8ZsBg2EeuH77eS3yKljg", name: "Exits theater"},    
     {oid: "_lK4-wBg2EeuH77eS3yKljg", name: "Drives home"}    
   ]},  
  {oid: "_zt2HUBg1EeuH77eS3yKljg", name: "Mobile App", resourceType: "«Software»",
   usecases: [
     {oid: "_FtT9kBg2EeuH77eS3yKljg", name: "Looks up movies"},    
     {oid: "_I1cMIBg2EeuH77eS3yKljg", name: "Decides which movies to see and which theater to go to"},    
     {oid: "_KUoG8Bg2EeuH77eS3yKljg", name: "Buys ticket online"}    
   ]}  
];

const touchpointsMap = {
  "_0ng6QBg1EeuH77eS3yKljg": {oid: "_0ng6QBg1EeuH77eS3yKljg", name: "Movie Theater", resourceType: "«Site»",},  
  "_zt2HUBg1EeuH77eS3yKljg": {oid: "_zt2HUBg1EeuH77eS3yKljg", name: "Mobile App", resourceType: "«Software»",}  
};

</script>
</head>
<body>

<div class="menu">
<a href="Richard_JourneyMap.html">Richard</a></div>
  
<div class="header">
  <a href="https://www.script-conductive.com" target="_blank">
    <img src="https://cdn.script-conductive.com/logos/logo.png" alt="logo" />
  </a>
  <h1>SCDT</h1>
</div>
<h1>Richard's Journey Map</h1>

<div id="JourneyMap" class="table"></div>

<h1>Expectation</h1>
<ul>
<li>
  Friendly Staff 
</li>
<li>
  Good Seat 
</li>
<li>
  Great Movie 
</li>
</ul>

<h1>Touchpoint Detail</h1>
<div id="TouchpointDetail" class="table"></div>

<script>
const height = "300px";
const layout = "fitColumns";  // fitColumns, fitDataStretch, fitDataTable

function getStepUsedTime(step) {
  return step && step.usedTimeValue > 0  ? step.usedTimeValue + " " + step.usedTimeUnit : "";
}

function getStepCurrentEmotionScore(step) {
  return step && step.currentEmotionScore ? step.currentEmotionScore : "";
}

function getStepExtraInfo(step) {
 const usedTime = getStepUsedTime(step);
 const currentEmotionScore = getStepCurrentEmotionScore(step);
 if ( (usedTime.length + currentEmotionScore.length) == 0) {
   return "";
 } else {
   return "<sup>(" + (usedTime) + (currentEmotionScore) +")</sup>";
 }
}

function getStepTouchpoint(stepOid) {
  return stepTouchpointMap.hasOwnProperty(stepOid) ? stepTouchpointMap[stepOid] : {
    oid: "",
    name: ""
  }
}
function getTouchpoint(tpOid) {
  return touchpointsMap.hasOwnProperty(tpOid) ? touchpointsMap[tpOid] : {
    oid: "UndefinedAsset",
    name: "",
    resourceType: ""
  }
}
let journeyMapTableData = [];
for (const [stageKey, stageObj] of Object.entries(stagesMap)) {
  if (stageUseCases.filter((u)=> u.oid == stageObj.oid).length > 0) {
    stageObj.steps.forEach((s) => {
      journeyMapTableData.push({
      id: s.oid,
      type: "Step",
      stepObject: stepsMap[s.oid],
      touchpointObject: stepTouchpointMap[s.oid],
      touchpoint: getTouchpoint(getStepTouchpoint(s.oid).oid).resourceType + " <b>" + getStepTouchpoint(s.oid).name + "</b>",
      serviceResource: stepsMap[s.oid] ? stepsMap[s.oid].serviceResources.map((r) => { 
         if (serviceResourcesMap[r.oid]) {
           return serviceResourcesMap[r.oid].resourceType + " <b>" + r.name + "</b>";
         } else {
           return "";
         } 
      }).join("\n") : "",
      Decide: 
        relevantStagesNameMap.includes("Decide") == true && stagesMap["_U8SCIBg2EeuH77eS3yKljg"].steps.filter(o => o.oid == s.oid).length > 0 
         ? "<b>" + (stepsMap[s.oid] ? stepsMap[s.oid].name : "") + "</b> " + getStepExtraInfo(stepsMap[s.oid])
         : "",      
      Travel: 
        relevantStagesNameMap.includes("Travel") == true && stagesMap["_acuL4Bg2EeuH77eS3yKljg"].steps.filter(o => o.oid == s.oid).length > 0 
         ? "<b>" + (stepsMap[s.oid] ? stepsMap[s.oid].name : "") + "</b> " + getStepExtraInfo(stepsMap[s.oid])
         : "",      
      Experience: 
        relevantStagesNameMap.includes("Experience") == true && stagesMap["_fHWvABg2EeuH77eS3yKljg"].steps.filter(o => o.oid == s.oid).length > 0 
         ? "<b>" + (stepsMap[s.oid] ? stepsMap[s.oid].name : "") + "</b> " + getStepExtraInfo(stepsMap[s.oid])
         : "",      
      Return: 
        relevantStagesNameMap.includes("Return") == true && stagesMap["_nj3oUBg2EeuH77eS3yKljg"].steps.filter(o => o.oid == s.oid).length > 0 
         ? "<b>" + (stepsMap[s.oid] ? stepsMap[s.oid].name : "") + "</b> " + getStepExtraInfo(stepsMap[s.oid])
         : ""      
      });
      
      for (const [dataKey, dataObj] of Object.entries(journeyMapTableData)) {
        if (irrelevantStagesNameMap.includes(dataKey)) {
          delete journeyMapTableData[dataKey];
        }
      }
      
      console.log(journeyMapTableData)
    });
  }
}
   
new Tabulator("#JourneyMap", {
  height: height,
  layout: layout,
  data: journeyMapTableData,
  columns:[
  	{title:"Enabling Resource", field:"serviceResource", width:250, hozAlign:"right", formatter: "html"},
  	{title:"Touchpoint", field:"touchpoint", width:140, hozAlign:"right", formatter: "html"},
    {
      title:"Richard's Journey Stages",
      columns:  stageUseCases.map((uc) => {
        return {
          title: uc.name,
          field: uc.name,
          hozAlign: "left",
          headerSort: false,
          headerVertical: false,
          formatter: "html",
          formatterParams: {
            wrap: true
          }
         } 
      })
    }
  ]
});

const touchpointDetailTableData = [];
touchpoints.forEach((tp) => {
  touchpointDetailTableData.push({
    id: tp.oid,
    type: "Touchpoint",
    "Movie Theater":
      tp.name == "Movie Theater" ?
      tp.usecases.map((u) => {
        return "<b>" + u.name + "</b>"  
      }).join("<br>") : "",      
    "Mobile App":
      tp.name == "Mobile App" ?
      tp.usecases.map((u) => {
        return "<b>" + u.name + "</b>"  
      }).join("<br>") : ""      
  });
});

new Tabulator("#TouchpointDetail", {
  height: height,
  layout: layout,
  data: touchpointDetailTableData,
  columns:[
    {
      title:"Touchpoint & Case Allocation",
      columns:  touchpoints.map((tp) => {
        return {
          title: tp.name,
          field: tp.name,
          hozAlign: "left",
          headerSort: false,
          headerVertical: false,
          formatter: "html",
          formatterParams: {
            wrap: true
          }
         } 
      })
    }
  ]
});
</script>
</body>
</html>

